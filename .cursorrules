# PhotoZen å›¾ç¦… - AI å¼€å‘åŠ©æ‰‹æŒ‡å—

> ğŸ“Œ ç‰ˆæœ¬: v1.6.0 | æœ€åæ›´æ–°: 2026-01-18

---

## 1. é¡¹ç›®æ¦‚è¿°

**PhotoZenï¼ˆå›¾ç¦…ï¼‰** æ˜¯ä¸€æ¬¾ä¸“ä¸ºæ‘„å½±çˆ±å¥½è€…è®¾è®¡çš„ç…§ç‰‡æ•´ç† Appã€‚

### æ ¸å¿ƒåŠŸèƒ½
- **æ»‘åŠ¨æ•´ç†**ï¼šTinder é£æ ¼æ»‘åŠ¨ç­›é€‰ç…§ç‰‡ï¼ˆä¿ç•™/åˆ é™¤/å¾…å®šï¼‰
- **ç…§ç‰‡å¯¹æ¯”**ï¼šLight Table æ¨¡å¼ï¼ŒåŒæ­¥ç¼©æ”¾å¯¹æ¯” 2-6 å¼ ç…§ç‰‡
- **æ—¶é—´çº¿æµè§ˆ**ï¼šæŒ‰æ—¶é—´æ™ºèƒ½åˆ†ç»„ï¼Œæ”¯æŒå…¨å±é¢„è§ˆ
- **ä¸€ç«™å¼æ•´ç†**ï¼šåŠ¨æ€å¤šé˜¶æ®µå·¥ä½œæµï¼ˆç­›é€‰â†’å¯¹æ¯”â†’åˆ†ç±»â†’æ¸…ç†â†’èƒœåˆ©ï¼‰
- **ç›¸å†Œåˆ†ç±»**ï¼šæˆ‘çš„ç›¸å†Œç®¡ç†ï¼Œæ»‘åŠ¨æ—¶å¯ç›´æ¥åˆ†ç±»
- **æˆå°±ç³»ç»Ÿ**ï¼š50+ æˆå°±å¾½ç« ï¼Œæ¸¸æˆåŒ–æ•´ç†ä½“éªŒ

### é‡è¦æ–‡æ¡£
- `PRD.md` - äº§å“åŠŸèƒ½è¯´æ˜æ–‡æ¡£
- `TECH_DESIGN.md` - æŠ€æœ¯è®¾è®¡æ–‡æ¡£
- `CHANGELOG.md` - ç‰ˆæœ¬æ›´æ–°è®°å½•

---

## 2. æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ |
|:----:|:-----|
| è¯­è¨€ | Kotlin 2.0 |
| UI | Jetpack Compose + Material 3 |
| æ¶æ„ | MVVM + Clean Architecture |
| DI | Hilt |
| å¼‚æ­¥ | Coroutines + Flow |
| æ•°æ®åº“ | Room |
| åå¥½ | DataStore |
| å›¾ç‰‡ | Coil 3 |
| å¯¼èˆª | Compose Navigation (Type-Safe) |

---

## 3. é¡¹ç›®ç»“æ„é€ŸæŸ¥

```
app/src/main/java/com/example/photozen/
â”œâ”€â”€ data/                    # æ•°æ®å±‚
â”‚   â”œâ”€â”€ local/dao/           # Room DAO
â”‚   â”œâ”€â”€ local/entity/        # Room Entity
â”‚   â”œâ”€â”€ repository/          # æ•°æ®ä»“åº“
â”‚   â””â”€â”€ source/              # æ•°æ®æº (MediaStore)
â”œâ”€â”€ domain/                  # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ usecase/             # ç”¨ä¾‹
â”‚   â””â”€â”€ AchievementManager.kt
â”œâ”€â”€ ui/                      # UI å±‚
â”‚   â”œâ”€â”€ screens/             # é¡µé¢ (Screen + ViewModel)
â”‚   â”œâ”€â”€ components/          # é€šç”¨ç»„ä»¶
â”‚   â””â”€â”€ theme/               # ä¸»é¢˜
â”œâ”€â”€ navigation/              # å¯¼èˆª
â”‚   â”œâ”€â”€ Screen.kt            # æ‰€æœ‰è·¯ç”±å®šä¹‰
â”‚   â””â”€â”€ PicZenNavHost.kt     # å¯¼èˆªå›¾
â”œâ”€â”€ service/                 # åå°æœåŠ¡
â””â”€â”€ util/                    # å·¥å…·ç±»
```

### å¿«é€Ÿå®šä½æ–‡ä»¶

| åŠŸèƒ½ | æ–‡ä»¶ä½ç½® |
|:-----|:--------|
| æ»‘åŠ¨æ•´ç† | `ui/screens/flowsorter/` |
| ç…§ç‰‡å¯¹æ¯” | `ui/screens/lighttable/` |
| æ—¶é—´çº¿ | `ui/screens/timeline/` |
| ä¸€ç«™å¼æ•´ç† | `ui/screens/workflow/` |
| ç›¸å†Œç®¡ç† | `ui/screens/albums/` |
| è®¾ç½® | `ui/screens/settings/` |
| å¯¼èˆª | `navigation/Screen.kt` |
| åå¥½è®¾ç½® | `data/repository/PreferencesRepository.kt` |

---

## 4. ä»£ç è§„èŒƒ

### 4.1 å‘½åçº¦å®š
```kotlin
// Screen Composable
@Composable
fun XxxScreen(
    onNavigateBack: () -> Unit,
    viewModel: XxxViewModel = hiltViewModel()
)

// ViewModel
@HiltViewModel
class XxxViewModel @Inject constructor(...) : ViewModel()

// UI State
data class XxxUiState(
    val isLoading: Boolean = false,
    val items: List<Item> = emptyList(),
    val error: String? = null
)
```

### 4.2 çŠ¶æ€ç®¡ç†æ¨¡å¼
```kotlin
// ViewModel å†…éƒ¨ä½¿ç”¨ MutableStateFlow
private val _uiState = MutableStateFlow(XxxUiState())
val uiState: StateFlow<XxxUiState> = _uiState.asStateFlow()

// æ›´æ–°çŠ¶æ€
private fun updateState(update: (XxxUiState) -> XxxUiState) {
    _uiState.update(update)
}

// Screen ä¸­æ”¶é›†çŠ¶æ€
val uiState by viewModel.uiState.collectAsState()
```

### 4.3 Flow æ•°æ®è§‚å¯Ÿ
```kotlin
// ä½¿ç”¨ distinctUntilChanged é¿å…é‡å¤å‘å°„
fun getSomeData(): Flow<Data> = dataStore.data.map { ... }.distinctUntilChanged()

// ViewModel ä¸­æ”¶é›† Flow
init {
    viewModelScope.launch {
        repository.getSomeData().collect { data ->
            updateState { it.copy(data = data) }
        }
    }
}
```

### 4.4 å›¾ç‰‡åŠ è½½
```kotlin
// ç¼©ç•¥å›¾ï¼ˆç½‘æ ¼åˆ—è¡¨ï¼‰
AsyncImage(
    model = ImageRequest.Builder(context)
        .data(photo.systemUri)
        .size(200, 200)  // é™åˆ¶è§£ç å°ºå¯¸
        .crossfade(true)
        .build(),
    contentDescription = null
)

// å…¨å±é¢„è§ˆ
AsyncImage(
    model = photo.systemUri,  // ä½¿ç”¨åŸå›¾
    contentDescription = null
)
```

---

## 5. å…³é”®å®ç°è¦ç‚¹

### 5.1 ç…§ç‰‡çŠ¶æ€
```kotlin
enum class PhotoStatus {
    UNSORTED,  // æœªç­›é€‰
    KEEP,      // ä¿ç•™
    MAYBE,     // å¾…å®š
    TRASH      // å›æ”¶ç«™
}
```

### 5.2 æ»‘åŠ¨æ‰‹åŠ¿å¤„ç†
```kotlin
// ä½¿ç”¨ pointerInput å¤„ç†æ‹–æ‹½
Modifier.pointerInput(Unit) {
    detectDragGestures(
        onDragEnd = { /* åˆ¤æ–­æ–¹å‘ï¼Œæ‰§è¡Œæ“ä½œ */ },
        onDrag = { change, dragAmount ->
            // æ›´æ–° offsetX, offsetY
        }
    )
}

// ä½¿ç”¨ Animatable å®ç° Spring åŠ¨ç”»
val offsetX = remember { Animatable(0f) }
offsetX.animateTo(0f, spring(dampingRatio = 0.6f))
```

### 5.3 åŒæ­¥ç¼©æ”¾ï¼ˆLight Tableï¼‰
```kotlin
// çˆ¶ç»„ä»¶æŒæœ‰ TransformState
val transformState = remember { mutableStateOf(TransformState()) }

// æ‰€æœ‰å­å›¾ç‰‡è§‚å¯ŸåŒä¸€ä¸ª state
photos.forEach { photo ->
    SyncZoomImage(
        photo = photo,
        transformState = transformState
    )
}
```

### 5.4 ä¸€ç«™å¼æ•´ç†é˜¶æ®µ
```kotlin
enum class WorkflowStage {
    SWIPE,     // ç­›é€‰
    COMPARE,   // å¯¹æ¯”å¾…å®š
    CLASSIFY,  // åˆ†ç±»åˆ°ç›¸å†Œï¼ˆä»…å½“æœªå¼€å¯ç›´æ¥åˆ†ç±»ï¼‰
    TRASH,     // æ¸…ç†å›æ”¶ç«™
    VICTORY    // èƒœåˆ©
}

// åŠ¨æ€é˜¶æ®µåˆ—è¡¨
val stageList = if (cardSortingAlbumEnabled) {
    listOf(SWIPE, COMPARE, TRASH, VICTORY)
} else {
    listOf(SWIPE, COMPARE, CLASSIFY, TRASH, VICTORY)
}
```

---

## 6. å¸¸è§å¼€å‘ä»»åŠ¡æŒ‡å—

### 6.1 æ·»åŠ æ–°é¡µé¢
1. åœ¨ `Screen.kt` æ·»åŠ æ–°çš„ Screen å®šä¹‰
2. åœ¨ `ui/screens/` ä¸‹åˆ›å»ºç›®å½•ï¼ŒåŒ…å« `XxxScreen.kt` å’Œ `XxxViewModel.kt`
3. åœ¨ `PicZenNavHost.kt` æ·»åŠ  composable è·¯ç”±

### 6.2 æ·»åŠ æ–°è®¾ç½®é¡¹
1. åœ¨ `PreferencesRepository.kt` æ·»åŠ  Key å®šä¹‰
2. æ·»åŠ  get/set æ–¹æ³•
3. åœ¨ `SettingsScreen.kt` æ·»åŠ  UI

### 6.3 ä¿®æ”¹æ•°æ®åº“
1. ä¿®æ”¹ `entity/` ä¸‹çš„ Entity
2. åœ¨ `AppDatabase.kt` å¢åŠ ç‰ˆæœ¬å·
3. æ·»åŠ  Migrationï¼ˆå¦‚éœ€ä¿ç•™æ•°æ®ï¼‰

### 6.4 æ·»åŠ æ–°æˆå°±
1. åœ¨ `ui/components/AchievementSystem.kt` çš„ `generateAchievements()` ä¸­æ·»åŠ 
2. ç¡®ä¿ `PreferencesRepository` æœ‰å¯¹åº”çš„è®¡æ•°å™¨

---

## 7. é‡è¦çº¦å®š

### 7.1 ç‰ˆæœ¬å·è§„åˆ™
```
w.x.y.z
â”œâ”€â”€ w: å¤§ç‰ˆæœ¬å·ï¼ˆé‡å¤§åŠŸèƒ½æ›´æ–°ï¼‰
â”œâ”€â”€ x: å°ç‰ˆæœ¬å·ï¼ˆåŠŸèƒ½æ›´æ–°ï¼Œéœ€æ›´æ–° CHANGELOGï¼‰
â”œâ”€â”€ y: ä¿®å¤ç‰ˆæœ¬å·
â””â”€â”€ z: æ„å»ºå·ï¼ˆæ¯æ¬¡æ„å»ºè‡ªåŠ¨ +1ï¼‰
```

### 7.2 åˆ†æ”¯ç®¡ç†
- `main`: ä¸»åˆ†æ”¯ï¼Œæ‰€æœ‰å¸¸è§„å¼€å‘
- `explore/smart-gallery`: å®éªŒåˆ†æ”¯ï¼ŒAI ç›¸å…³åŠŸèƒ½
- **ä¸»åˆ†æ”¯å˜æ›´å¿…é¡»åˆå¹¶åˆ°å®éªŒåˆ†æ”¯**

### 7.3 æ–‡ä»¶æ“ä½œåŸåˆ™
- **éç ´åæ€§**ï¼šåˆ é™¤æ“ä½œåªä¿®æ”¹æ•°æ®åº“çŠ¶æ€ï¼Œä¸åˆ é™¤åŸæ–‡ä»¶
- **æ°¸ä¹…åˆ é™¤**ï¼šä»…åœ¨ç”¨æˆ·æ˜ç¡®æ“ä½œæ—¶ï¼Œé€šè¿‡ MediaStore API åˆ é™¤

### 7.4 æ€§èƒ½åŸåˆ™
- åˆ—è¡¨å›¾ç‰‡ï¼šé™åˆ¶è§£ç å°ºå¯¸ `size(200, 200)`
- åˆ†é¡µåŠ è½½ï¼š`LIMIT 500` + Flow ç›‘å¬å˜åŒ–
- é¿å…é‡ç»„ï¼šä½¿ç”¨ `remember`ã€`key`ã€`derivedStateOf`

---

## 8. ç¦æ­¢äº‹é¡¹

âŒ **ä¸è¦åšä»¥ä¸‹äº‹æƒ…ï¼š**

1. **ä¸è¦ç›´æ¥åˆ é™¤ç³»ç»Ÿç…§ç‰‡**
   - å¿…é¡»é€šè¿‡ `MediaStore.createDeleteRequest()` è®©ç”¨æˆ·ç¡®è®¤

2. **ä¸è¦åœ¨ Composable ä¸­åˆ›å»º ViewModel**
   - ä½¿ç”¨ `hiltViewModel()` æˆ–é€šè¿‡å‚æ•°ä¼ å…¥

3. **ä¸è¦åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œ**
   - æ•°æ®åº“ã€æ–‡ä»¶æ“ä½œå¿…é¡»åœ¨ `Dispatchers.IO`

4. **ä¸è¦æš´éœ² MutableStateFlow**
   - åªæš´éœ²åªè¯»çš„ `StateFlow`

5. **ä¸è¦å¿½ç•¥ Flow çš„ distinctUntilChanged**
   - é˜²æ­¢ä¸å¿…è¦çš„é‡å¤å‘å°„

6. **ä¸è¦ç¡¬ç¼–ç å­—ç¬¦ä¸²**
   - UI æ–‡å­—æ”¾åœ¨ä»£ç ä¸­æš‚å¯æ¥å—ï¼Œä½†æ•°æ®ç›¸å…³çš„å¸¸é‡å¿…é¡»å®šä¹‰

---

## 9. è°ƒè¯•æŠ€å·§

### æ—¥å¿—æŸ¥çœ‹
```kotlin
import android.util.Log
Log.d("PhotoZen", "message")
```

### ADB è·¯å¾„
```
D:\androidsdk\platform-tools\adb.exe
```

### å¸¸ç”¨å‘½ä»¤
```bash
# æ— çº¿è°ƒè¯•è¿æ¥
adb connect <IP>:5555

# å®‰è£… APK
adb install -r app-debug.apk

# æŸ¥çœ‹æ—¥å¿—
adb logcat | grep PhotoZen
```

---

## 10. å›ç­”é—®é¢˜æ—¶çš„å»ºè®®

å½“ç”¨æˆ·è¯¢é—®é¡¹ç›®ç›¸å…³é—®é¢˜æ—¶ï¼š

1. **å…ˆé˜…è¯»ç›¸å…³æ–‡æ¡£**
   - `PRD.md` äº†è§£åŠŸèƒ½éœ€æ±‚
   - `TECH_DESIGN.md` äº†è§£æŠ€æœ¯å®ç°
   - `CHANGELOG.md` äº†è§£ç‰ˆæœ¬å†å²

2. **å®šä½ç›¸å…³ä»£ç **
   - ä½¿ç”¨æœ¬æ–‡ä»¶çš„"å¿«é€Ÿå®šä½æ–‡ä»¶"è¡¨æ ¼
   - ä¼˜å…ˆæŸ¥çœ‹ ViewModel äº†è§£ä¸šåŠ¡é€»è¾‘
   - æŸ¥çœ‹ Screen äº†è§£ UI ç»“æ„

3. **éµå¾ªç°æœ‰æ¨¡å¼**
   - å‚è€ƒç›¸ä¼¼åŠŸèƒ½çš„å®ç°æ–¹å¼
   - ä¿æŒä»£ç é£æ ¼ä¸€è‡´

4. **è€ƒè™‘å½±å“èŒƒå›´**
   - ä¿®æ”¹ Entity éœ€è¦è€ƒè™‘æ•°æ®åº“è¿ç§»
   - ä¿®æ”¹ Navigation éœ€è¦æ£€æŸ¥æ‰€æœ‰å¯¼èˆªå…¥å£
   - ä¿®æ”¹å…¬å…±ç»„ä»¶éœ€è¦æ£€æŸ¥æ‰€æœ‰ä½¿ç”¨å¤„

---

*æ­¤æ–‡ä»¶ç”¨äºæŒ‡å¯¼ AI åŠ©æ‰‹é«˜æ•ˆã€é«˜è´¨é‡åœ°å‚ä¸ PhotoZen é¡¹ç›®å¼€å‘ã€‚*
