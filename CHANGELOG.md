# Changelog

所有版本更新记录。

版本号规则：`主版本.次版本.修复版本.构建号`
- 第一位：重大功能更新
- 第二位：一般功能更新  
- 第三位：Bug 修复
- 第四位：构建号

---

## [1.6.0.001] - 2026-01-18

### 🎯 功能重构与一站式整理升级

本版本进行大规模功能重构，删除标签模块，完善相册分类体验，新增系统分享能力，并将一站式整理流程升级为更完整的多阶段工作流。

### 功能精简

- **删除标签模块**：移除标签气泡、快速标签等功能，让应用更专注于照片整理核心流程
- **简化通知设置**：删除每日提醒设置，仅保留状态栏进度通知，进度通知新增激励文案
- **简化首页布局**：删除一站式整理开关和首页组件，界面更清爽

### 相册分类增强

- **添加到相册弹窗**：新增通用"添加到相册"弹窗组件，支持勾选多个相册
- **多处添加相册入口**：筛选照片列表多选、保留照片列表、长按操作均可添加到相册
- **底部栏布局优化**：选择模式底部栏改为上下布局（图标在上、文字在下），操作更清晰

### 多选体验优化

- **拖动批量选择**：长按照片后拖动可批量选择多张照片，体验与 Google Photos 一致
- **应用范围**：保留照片列表、回收站列表、待定照片列表、筛选照片列表

### 系统分享功能

- **接收分享**：支持从其他 app 分享照片到 PhotoZen
- **复制照片**：分享的照片可复制到相册，保留 EXIF 信息
- **对比照片**：分享 2-6 张照片可直接进入对比模式

### 时间线增强

- **全屏预览**：点击时间线照片进入全屏预览，支持双指缩放、循环切换
- **底部操作栏**：全屏预览时底部显示添加到相册、删除、标记状态等操作
- **照片状态角标**：照片左上角显示状态角标（保留/待定/回收站）

### 保留照片列表优化

- **快速整理入口**：显示不在相册中的照片数量，一键进入分类模式
- **显示开关**：可切换是否显示已在相册中的照片

### 相册照片列表优化

- **刷新修复**：修复删除/移动照片后列表不实时更新的问题
- **全局状态筛选**：顶部 FilterChip 可按保留/待定/回收站/未筛选状态筛选
- **从此张开始筛选**：长按照片可从当前位置开始筛选流程

### 一站式整理流程升级

- **动态阶段**：根据是否开启"直接分类到相册"，自动切换 3 阶段或 4 阶段模式
  - 3 阶段：筛选 → 对比待定 → 清理回收站 → 胜利
  - 4 阶段：筛选 → 对比待定 → 分类到相册 → 清理回收站 → 胜利
- **分类到相册阶段**：逐张处理保留照片，点击相册按钮即可分类
- **清理回收站阶段**：批量选择回收站照片，支持恢复或永久删除
- **增强胜利页面**：展示更丰富的统计数据（分类到相册数、永久删除数等）
- **智能跳过**：无照片的阶段自动跳过，流程更顺畅

### UI 修复

- **滑块修复**：修复设置中相册标签大小滑块不能拖到头的问题
- **按钮对齐**：修复卡片滑动视图底部相册按钮垂直不对齐
- **标题优化**：快速整理页面删除 "Flow Sorter" 文字，放大进度显示
- **信息位置**：开启相册模式时，照片信息移到顶部显示，避免与底部相册标签重叠

---

## [1.5.0.007] - 2026-01-18

### 🔔 前台服务保活 - 彻底解决提醒问题

通过前台服务方案彻底解决每日提醒在 app 被杀死后无法触发的问题。

### 核心改进

- **前台服务保活**：通过常驻通知保持 app 存活，确保提醒准时送达
- **状态栏进度显示**：在状态栏实时显示每日整理进度（已整理/目标数量）
- **开机自启动**：手机重启后自动恢复服务，无需手动打开 app
- **可选开关**：设置页新增"状态栏进度通知"开关，可按需关闭

### 用户体验

- 点击状态栏通知可直接跳转进入 app
- 进度通知静默显示，不打扰日常使用
- 到点提醒会弹出独立高优先级通知
- 完成每日目标后通知显示庆祝标题

---

## [1.5.0.006] - 2026-01-18

### 🔔 每日提醒可靠性升级

本版本彻底修复每日任务提醒无法触发的问题，采用业界最佳实践确保通知可靠送达。

### 核心改进

- **采用 AlarmClock API**：使用 Android 最高优先级的闹钟调度方式，绕过 Doze 模式限制
- **静默通知**：提醒通知改为静默模式，不会发出声音或振动，只在通知栏显示
- **权限优化**：通知权限改为在用户开启每日提醒时才请求，不再在启动时打扰用户

### 修复

- **时间选择器**：修复设置提醒时间时，时间选择器默认滚动到 00:00 的问题
- **权限检查**：发送通知前检查权限，避免静默失败

---

## [1.5.0.005] - 2026-01-18

### 🔧 每日提醒修复

本版本修复每日任务提醒无法触发的问题。

### 修复

- **每日提醒初始化**：应用启动时自动检查并设置每日提醒闹钟
- **时间选择器默认值**：修复设置提醒时间时，时间选择器未显示当前已设置时间的问题

---

## [1.5.0.003] - 2026-01-18

### 📅 时间线功能

本版本新增时间线浏览功能，让照片整理更加直观高效。

### 新增功能

#### 📅 时间线浏览（核心功能）
- **按时间分组浏览**：照片自动按时间聚合成事件分组
- **多种分组模式**：支持智能分组、按天、按月、按年四种模式
- **智能分组算法**：基于时间间隔（4小时）和地点变化自动识别不同事件
- **整理进度显示**：每个分组显示"已整理/总数"的统计信息
- **快速整理入口**：点击分组右侧按钮可直接进入该时间段的整理流程
- **展开预览**：点击分组可展开查看缩略图预览
- **正序/倒序切换**：顶部导航栏一键切换时间排序方向
- **年月快速导航**：智能分组和按天模式下支持按年月快速跳转定位
- **查看更多优化**：点击"查看全部"直接跳转列表视图整理

#### 🎨 界面优化
- 时间线卡片简洁设计，突出整理进度和操作按钮
- 已全部整理的分组显示绿色标识
- 年月导航显示每月照片总数，布局更清晰

#### 🔧 体验改进
- 相册移动权限弹窗简化，移除"暂不授权"选项

---

## [1.4.1.001] - 2026-01-18

### 📁 相册分类模式 & 对比模式优化

本版本新增相册分类模式，让照片整理与相册管理无缝衔接，同时优化对比模式体验。

### 新增功能

#### 📁 相册分类模式（核心功能）
- **滑动整理支持相册分类**：筛选时可将照片直接加入相册，无需额外操作
- **智能路径识别**：正确识别系统相册路径（DCIM/Camera），不再创建重复相册
- **我的相册管理**：支持添加系统相册、自定义相册，气泡图与列表视图切换
- **列表拖拽排序**：相册列表支持拖动手柄调整顺序
- **照片信息展示优化**：相册模式下信息显示在照片本体，方便快速分类

#### 🔍 对比模式优化
- 浮动操作按钮优化，操作更便捷
- 同步缩放手势改进

#### 🎨 界面优化
- 首页返回时不再重复显示 Loading
- 成就系统分类与布局微调

### 修复

- 修复第一张照片滑动后计数器重置的问题
- 修复相册名称相同时路径混淆的问题
- 修复相册列表视图潜在的崩溃问题

---

## [1.3.1.046] - 2026-01-17

### 🎨 体验优化

本版本重点优化外观设置和滑动体验。

### 新增功能

#### 🎨 外观设置
- 新增主题模式切换（深色/浅色/跟随系统）
- 完善浅色主题配色方案

#### 👆 滑动体验优化
- 新增滑动灵敏度调节（设置页面可调）
- 不同方向应用不同阈值系数（下滑最易触发）
- 到达阈值时轻微震动反馈
- 阈值前后图标差异显示（空心→实心）

### 修复

- 修复滑动灵敏度修改后触发失效的问题
- 修复筛选状态下排序只在500张内生效的问题
- 修复上滑删除时偶发的加载错误提示

---

## [1.3.0.007] - 2026-01-17

### 🧪 体验优化与实验性功能

本版本修复关键问题并增加实验性功能入口。

### 新增功能

#### 🧪 实验性功能开关
- 设置中新增"实验性功能"开关，默认关闭
- 开启后首页显示智能画廊入口
- 描述："AI相关功能，施工中，不确定在您的手机上是什么样"

#### 📍 照片地点显示
- 照片信息现在显示拍摄地点（省 · 市）
- 纯离线逆地理编码，无需网络
- 内置中国约 340 个城市坐标数据

#### 📅 拍摄时间优化
- 照片信息显示完整日期时间（yyyy/MM/dd HH:mm）
- 更精确的时间记录

### 修复

#### 🔧 排序分页问题修复
- 修复切换排序方式时只在当前 500 张内排序的问题
- 现在切换排序会先对所有照片排序，再取前 500 张
- 支持"最新优先"和"最早优先"两种排序

---

## [1.3.0.007] - 2026-01-17

### 🧪 体验优化与实验性功能

本版本修复关键问题并增加实验性功能入口。

### 新增功能

#### 🧪 实验性功能开关
- 设置中新增"实验性功能"开关，默认关闭
- 开启后首页显示智能画廊入口
- 描述："AI相关功能，施工中，不确定在您的手机上是什么样"

#### 📍 照片地点显示
- 照片信息现在显示拍摄地点（省 · 市）
- 纯离线逆地理编码，无需网络
- 内置中国约 340 个城市坐标数据

#### 📅 拍摄时间优化
- 照片信息显示完整日期时间（yyyy/MM/dd HH:mm）
- 更精确的时间记录

### 修复

#### 🔧 排序分页问题修复
- 修复切换排序方式时只在当前 500 张内排序的问题
- 现在切换排序会先对所有照片排序，再取前 500 张
- 支持"最新优先"和"最早优先"两种排序

---

## [1.2.0.020] - 2026-01-17

### 🎛️ 自定义首页版本

本版本增加首页布局自定义功能，让整理体验更灵活。

### 新增功能

#### 🎛️ 一站式整理开关
- 设置中新增"一站式整理"开关，默认关闭
- 开启：首页显示一站式整理模块（完整卡片样式）
- 关闭：首页隐藏一站式整理模块，更简洁

#### 📊 顶部统计显示
- 关闭一站式整理后，首页顶部显示待整理/已整理数量
- 小巧的统计条，不占用太多空间
- 让用户随时了解整理进度

#### 🔄 任务模式改名
- "心流模式"更名为"一条龙整理"
- 更直观地表达功能含义

#### 💬 意见反馈入口
- 设置页面新增"意见反馈与功能许愿"链接
- 方便用户提交反馈和建议

### 修复
- 修复设置页面版本号未更新的问题

---

## [1.1.0.018] - 2026-01-17

### 🚀 体验优化版本

本版本针对用户反馈进行了全面的体验优化。

### 功能改进

#### 🎯 首页布局优化
- **每日任务**升级为首页核心入口，采用大卡片突出显示
- **一站式整理**调整为次要入口，简洁紧凑的卡片样式
- 更符合日常使用习惯的布局顺序

#### ⚡ 快速滑动优化
- 彻底解决快速滑动时的崩溃问题
- 优化数据库查询，使用 `LIMIT` 和单独的 `COUNT` 查询避免 `CursorWindow` 溢出
- 恢复丝滑的 Spring 动画效果，告别卡顿

#### 📊 进度显示修复
- 修复快速整理模式分母显示为500的问题
- 现在正确显示所有待整理照片的真实总数
- 分子分母稳定，不再闪烁

#### 📱 桌面小组件优化
- 每日任务进度实时更新
- 布局优化，2x2格子内完整显示
- 去除重复的进度数字显示

#### ⚙️ 默认设置优化
- 每日任务默认使用**快速整理模式**（更高效）
- 每日提醒**默认开启**
- 提醒时间默认设为**晚上10点**

---

## [1.0.0.001] - 2026-01-16

### 🎉 第一个正式版本！

PhotoZen 图禅 —— 让整理照片变成一种享受。

### 核心功能

#### 🎴 滑动整理 (Flow Sorter)
- Tinder 风格滑动：左右保留、上滑删除、下滑待定
- Spring 动画和触觉反馈
- 列表视图支持批量选择
- 支持 1/2/3 列切换

#### 🔍 照片对比 (Light Table)
- 同时对比 2-4 张照片
- 同步缩放功能
- 快速决策

#### 🏷️ 标签气泡
- 物理模拟的可拖拽气泡
- 弹性碰撞和惯性滑动
- 位置自动记忆
- 支持层级结构

#### ✂️ 无损编辑
- 非破坏性裁切
- 虚拟副本管理
- 图片导出

#### 🚀 心流模式
- 一站式整理流程
- 连击系统
- 胜利庆祝动画

#### 🏆 成就系统
- 50+ 成就徽章
- 5 个稀有度等级
- 进度追踪

#### 📁 照片管理
- 智能筛选（全部/相机/排除相机/自定义）
- 日期和相册范围选择
- 批量操作
- 回收站管理
- 外部删除同步

---

## 开发历程

以下为开发过程中的内部版本记录（v0.x.x）：

### [0.5.9] - 2026-01-16
- 修复 Workflow 模式筛选计数显示
- UI 文案优化

### [0.5.8] - 2026-01-16
- Flow 筛选条件改为响应式 StateFlow
- CUSTOM 模式正确导航

### [0.5.7] - 2026-01-16
- Flow 列表视图列数切换
- 回收站批量待定
- Flow 会话照片追踪

### [0.5.6] - 2026-01-16
- 批量管理扩展到待定和回收站
- 标签照片批量操作
- 列数切换功能

### [0.5.5] - 2026-01-16
- 批量管理模式
- 标签气泡拖动体验优化
- 品牌升级为 PhotoZen 图禅

### [0.5.4] - 2026-01-16
- 首页布局调整
- 移动模式优化

### [0.5.3] - 2026-01-15
- 标签气泡拖拽
- 气泡位置记忆
- 成就庆祝特效

### [0.5.2] - 2026-01-15
- 成就统计模块
- 快速分类数量修复

### [0.5.1] - 2026-01-15
- 快速分类横幅
- 排序图标区分
- 复制照片时间戳修复

### [0.5.0] - 2026-01-15
- 照片排序功能
- 照片复制功能
- EXIF 保留

### [0.4.0] - 2026-01-14
- 新应用图标
- 标签与系统相册关联
- 瀑布流布局
- 分享照片功能

### [0.3.0] - 2026-01-12
- Flow Sorter 滑动整理
- Light Table 照片对比
- 连击和成就系统
- 虚拟副本

### [0.2.0] - 2026-01-10
- 标签管理系统
- 快速标签功能
- 照片筛选

### [0.1.0] - 2026-01-08
- 基础照片整理功能
- MediaStore 同步
- 状态管理

### [0.0.1] - 2026-01-05
- 初始版本
- 基础框架搭建
