# PhotoZen 图禅 - 产品需求文档

> 📅 文档版本: v2.0.0 | 更新日期: 2026-01-25

## 1. 产品概述

### 1.1 产品定位
PhotoZen（图禅）是一款专为摄影爱好者设计的 **照片整理神器**。通过 Tinder 风格的滑动操作、游戏化的连击系统和沉浸式的一站式整理流程，让繁琐的照片管理变成一种享受。

### 1.2 核心价值
- **高效**：滑动操作 + 批量处理，快速筛选海量照片
- **有趣**：连击系统 + 成就徽章，整理照片像玩游戏
- **安全**：无损编辑 + 回收站机制，操作可撤销
- **直观**：时间线浏览 + 多维度筛选，照片一目了然
- **丝滑**：精心设计的动画系统，提供流畅优雅的体验

### 1.3 版本信息
- **当前版本**: v2.0.0.007
- **发布日期**: 2026-01-25
- **代号**: Flow Release

---

## 2. 功能模块详解

### 2.1 滑动整理 (Flow Sorter)

**核心交互**：
| 滑动方向 | 操作 | 照片状态 | 震动反馈 |
|:------:|:----:|:-------:|:-------:|
| ← 左滑 | 保留 | KEEP | 轻微震动 |
| → 右滑 | 保留 | KEEP | 轻微震动 |
| ↑ 上滑 | 删除 | TRASH | 强震动 |
| ↓ 下滑 | 待定 | MAYBE | 双击震动 |

**两种视图模式**：
1. **卡片模式**：单张照片全屏显示，Spring 动画 + 触感反馈
   - 动态倾斜透视效果 (rotationX/rotationZ)
   - 动态阴影高度 (8dp~20dp)
   - 弹性回弹动画
2. **列表模式**：瀑布流网格（1-4列可切换），支持多选批量操作

**相册分类功能**（可选开启）：
- 卡片底部显示"我的相册"标签
- 点击标签自动将照片复制/移动到对应相册
- 滑动时同步分类，无需额外操作

**连击系统**：
- 快速滑动（间隔 < 1.5秒）累积连击数
- 连击越高，视觉反馈越强烈
- 颜色变化：白色 → 橙色 → 红色/火焰
- 震动反馈强度随连击递增

**底部预览条**：
- 显示当前照片在队列中的位置
- 支持点击跳转到指定照片
- 当前项高亮显示 (52dp vs 40dp)

---

### 2.2 照片对比 (Light Table)

**功能特点**：
- 同屏对比 2-6 张照片
- **同步缩放**：放大一张，其他照片同步放大到相同区域
- 长按查看单张大图
- 快速做出取舍决策

**使用场景**：
- 一站式整理的"对比待定"阶段
- 从系统分享入口对比照片
- 手动从待定列表进入

---

### 2.3 时间线浏览 (Timeline)

**分组模式**：
| 模式 | 说明 |
|:----:|:-----|
| 智能分组 | 基于 4 小时时间间隔 + 地点变化自动识别事件 |
| 按天 | 按拍摄日期分组 |
| 按月 | 按月份分组 |
| 按年 | 按年份分组 |

**交互功能**：
- 每个分组显示"已整理 / 总数"进度
- 点击分组展开预览缩略图
- 一键进入该时间段的整理流程
- 正序/倒序切换
- 年月快速导航跳转

**全屏预览**：
- 点击照片进入全屏预览
- 支持双指缩放
- 循环切换同组照片
- 底部操作栏：添加到相册、删除、标记状态

---

### 2.4 一站式整理 (Workflow)

**动态阶段流程**：

```
┌─────────────────────────────────────────────────────────────┐
│                    是否开启"直接分类到相册"?                   │
├─────────────────────────────────────────────────────────────┤
│   是 (3阶段模式)        │        否 (4阶段模式)               │
│   ↓                    │        ↓                          │
│   筛选照片              │        筛选照片                     │
│   ↓                    │        ↓                          │
│   对比待定              │        对比待定                     │
│   ↓                    │        ↓                          │
│   清理回收站            │        分类到相册                   │
│   ↓                    │        ↓                          │
│   胜利               │        清理回收站                   │
│                        │        ↓                          │
│                        │        胜利                      │
└─────────────────────────────────────────────────────────────┘
```

**各阶段说明**：
1. **筛选阶段**：滑动整理未筛选照片
2. **对比待定阶段**：对比本次标记为"待定"的照片，做最终决定
3. **分类到相册阶段**：逐张将"保留"照片分配到相册（仅当未开启直接分类时）
4. **清理回收站阶段**：批量选择回收站照片，恢复或永久删除
5. **胜利页面**：展示本次整理统计（整理数、保留数、删除数、耗时、最大连击等）

**智能跳过**：无照片的阶段自动跳过

---

### 2.5 列表页面

PhotoZen 提供多个专门的列表页面，每个列表有特定的数据来源、筛选条件和可用操作：

| 列表 | 数据来源 | 筛选条件 | 主要操作 |
|:-----|:---------|:---------|:---------|
| 待整理 | photos 表 | status=UNSORTED | 开始整理 |
| 保留 | photos 表 | status=KEEP | 分类到相册、重新筛选 |
| 待定 | photos 表 | status=MAYBE | 对比、决定去留 |
| 回收站 | photos 表 | status=TRASH | 恢复、永久删除 |
| 相册详情 | album_photos 关联 | bucket_id | 移除、移动、标记 |

**列表通用功能**：
- 多选模式（长按进入）
- 拖拽批量选择
- 底部操作栏（根据选择数量自适应）
- 全选/反选
- 排序切换

---

### 2.6 每日任务

**功能特点**：
- 可设置每日整理目标（默认 100 张）
- 支持"快速整理"和"一站式整理"两种模式
- 首页显示今日进度卡片
- 桌面小组件实时显示进度

**状态栏进度通知**：
- 常驻通知显示"已整理 / 目标"进度
- 完成目标后显示庆祝标题
- 点击通知直接进入 App
- 可在设置中关闭

---

### 2.7 相册管理

**我的相册**：
- 添加系统相册或创建自定义相册
- 气泡视图和列表视图切换
- 拖动手柄调整相册顺序
- 设置默认操作：复制到相册 / 移动到相册

**相册照片列表**：
- 按状态筛选（保留/待定/回收站/未筛选）
- 长按照片"从此张开始筛选"
- 多选后批量操作

---

### 2.8 照片状态与操作

**四种状态**：
| 状态 | 含义 | 角标颜色 | 渐变色 |
|:----:|:-----|:-------:|:-------|
| UNSORTED | 未筛选 | 灰色/无 | - |
| KEEP | 保留 | 绿色 ✓ | #22C55E → #16A34A |
| MAYBE | 待定 | 黄色 ? | #FBBF24 → #F59E0B |
| TRASH | 回收站 | 红色 ✗ | #EF4444 → #DC2626 |

**批量操作**：
- 长按进入多选模式
- 拖动批量选择（类似 Google Photos）
- 支持操作：标记状态、添加到相册、删除、分享

**撤销机制**：
- 所有状态变更操作支持撤销
- Snackbar 显示操作结果 + 撤销按钮
- 撤销栈深度：无限制

---

### 2.9 系统分享功能

**接收分享**：
- 从其他 App 分享照片到 PhotoZen
- 支持单张和多张照片

**操作选项**：
| 功能 | 说明 |
|:----:|:-----|
| 复制照片 | 将分享的照片复制到指定相册，保留 EXIF |
| 对比照片 | 2-6 张照片直接进入对比模式 |

---

### 2.10 成就系统

**成就分类**：
- 整理成就（整理照片数量里程碑）
- 连击成就（最高连击记录）
- 坚持成就（连续活跃天数）
- 效率成就（单日整理超 100 张）
- 探索成就（使用各种功能）

**稀有度等级**：
普通 → 稀有 → 史诗 → 传说 → 神话

**50+ 成就徽章**，解锁时弹出庆祝动画

---

### 2.11 无损编辑

**裁切功能**：
- 只保存裁切参数，不修改原图
- 支持任意比例和常用比例预设
- 导出时才真正处理

**虚拟副本**：
- 一张照片可创建多个虚拟副本
- 每个副本独立的裁切参数
- 方便保留同一照片的多种构图

---

## 3. 设计系统

### 3.1 设计 Token

PhotoZen 使用统一的设计 Token 系统确保一致性：

**间距 Token (PicZenTokens.Spacing)**:
```
XXS=2dp, XS=4dp, S=8dp, M=12dp, L=16dp, XL=24dp, XXL=32dp, XXXL=48dp
```

**圆角 Token (PicZenTokens.Radius)**:
```
None=0dp, XS=4dp, S=8dp, M=12dp, L=16dp, XL=24dp, Full=9999dp
```

**阴影层级 (PicZenTokens.Elevation)**:
```
Level0=0dp, Level1=1dp, Level2=3dp, Level3=6dp, Level4=8dp, Level5=12dp
```

### 3.2 动效系统

**时长规范 (PicZenMotion.Duration)**:
| 类型 | 时长 | 用途 |
|:-----|:-----|:-----|
| Instant | 50ms | 立即响应 |
| Quick | 100ms | 快速反馈 |
| Fast | 150ms | 短促动画 |
| Normal | 200ms | 标准动画 |
| Moderate | 300ms | 中等动画 |
| Slow | 450ms | 强调动画 |
| Deliberate | 600ms | 戏剧化效果 |

**弹簧动画类型**:
- `snappy()`: 快速响应，无弹跳
- `default()`: 标准弹簧
- `playful()`: 活泼弹跳，用于回弹
- `gentle()`: 柔和弹簧

### 3.3 颜色系统

**操作色彩**:
| 操作 | 主色 | 发光色 | 容器色 |
|:-----|:-----|:-------|:-------|
| Keep | #22C55E | 25% alpha | #0D3320 |
| Trash | #EF4444 | 25% alpha | #3D1515 |
| Maybe | #FBBF24 | 25% alpha | #3D3115 |

**表面层级 (深色模式)**:
```
Background: #0A0A0C
Surface0: #0F0F12
Surface1: #1A1A1F
Surface2: #252529
Surface3: #2F2F35
Surface4: #3A3A42
```

---

## 4. 用户使用流程

### 4.1 首次使用
1. 授权照片权限
2. App 自动扫描并同步照片到本地数据库
3. 显示快速入门引导
4. 进入首页开始整理

### 4.2 日常使用
1. **方式一**：点击"每日任务"卡片，按目标整理
2. **方式二**：点击"时间线"，按时间维度整理
3. **方式三**：进入"相册"，按相册整理
4. **方式四**：直接进入"快速整理"自由整理

### 4.3 照片管理
- 在"保留"列表查看已保留照片，可快速分类到相册
- 在"待定"列表对比纠结的照片
- 在"回收站"最终决定是否永久删除

---

## 5. 设置选项

| 设置项 | 说明 | 默认值 |
|:------|:-----|:------:|
| 每日任务目标 | 1-1000 张 | 100 |
| 任务模式 | 快速整理 / 一站式整理 | 快速整理 |
| 状态栏进度通知 | 是否显示常驻通知 | 开启 |
| 直接分类到相册 | 滑动时显示相册标签 | 关闭 |
| 相册操作方式 | 复制 / 移动 | 移动 |
| 相册标签大小 | 0.8x - 1.2x | 1.0x |
| 滑动灵敏度 | 0.5 - 1.5 | 1.0 |
| 震动反馈 | 开启 / 关闭 | 开启 |
| 主题模式 | 深色/浅色/跟随系统 | 深色 |
| 实验性功能 | 启用 AI 功能入口 | 关闭 |

---

## 6. 技术规格

### 6.1 技术栈
- **语言**: Kotlin 2.0
- **UI 框架**: Jetpack Compose 1.6+
- **设计系统**: Material 3 + 自定义扩展
- **依赖注入**: Hilt 2.51+
- **数据库**: Room 2.6+
- **设置存储**: DataStore 1.1+
- **图片加载**: Coil 3.0+
- **异步编程**: Coroutines + Flow 1.8+

### 6.2 架构模式
- **整体架构**: Clean Architecture
- **UI 架构**: MVVM + UiState
- **状态管理**: StateFlow + 子状态拆分
- **导航**: Navigation Compose

### 6.3 最低要求
- **Android 版本**: Android 10 (API 29)+
- **权限**: 照片访问权限

---

## 7. 相关文档

| 文档 | 说明 |
|:-----|:-----|
| [DESIGN_SYSTEM.md](DESIGN_SYSTEM.md) | 设计系统完整规范 |
| [ARCHITECTURE.md](ARCHITECTURE.md) | 技术架构设计 |
| [TECH_DESIGN.md](TECH_DESIGN.md) | 技术设计文档 |
| [INTERACTION_SPEC.md](INTERACTION_SPEC.md) | 交互设计规范 |
| [GESTURE_SPEC.md](GESTURE_SPEC.md) | 手势交互规范 |
| [STATE_MANAGEMENT.md](STATE_MANAGEMENT.md) | 状态管理指南 |
| [COMPONENT_USAGE.md](COMPONENT_USAGE.md) | 组件使用示例 |

---

## 8. 版本历史

### v2.0.0 (2026-01-25) - Flow Release
- 完整实现 67 项功能需求 (REQ-001 ~ REQ-067)
- 实现 33 项设计优化 (DES-001 ~ DES-033)
- 统一设计 Token 系统
- 统一动效系统
- 增强视觉反馈和交互体验
- 丝滑流畅的动画效果

### v1.6.0 (2026-01-18)
- 基础功能完成
- 滑动整理
- 相册管理
- 成就系统

---

*本文档由 Claude Code 自动生成和维护*
