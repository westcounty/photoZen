# PhotoZen 照片列表需求 - 第1层总体规划

> 生成日期: 2026-01-25
> 更新日期: 2026-01-25 (实现完成)
> 需求文档: docs/REQUIREMENTS_LISTING.md (67个需求点)
> 状态: ✅ **全部67个需求已完成实现**

---

## 模块划分总览

```
┌─────────────────────────────────────────────────────────────────────┐
│ 模块依赖关系图                                                        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│    ┌──────────┐     ┌──────────┐                                   │
│    │ 模块 A   │────▶│ 模块 B   │                                   │
│    │ 通用视图  │     │ 全屏预览  │                                   │
│    └────┬─────┘     └────┬─────┘                                   │
│         │                │                                          │
│    ┌────┴────────────────┴────┐                                    │
│    │         基础层            │                                    │
│    └──────────┬───────────────┘                                    │
│               │                                                     │
│    ┌──────────┼───────────────┐                                    │
│    ▼          ▼               ▼                                    │
│ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐           │
│ │模块C │ │模块D │ │模块E │ │模块F │ │模块G │ │模块H │           │
│ │待定  │ │回收站│ │已保留│ │相册  │ │时间线│ │筛选  │           │
│ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘           │
│                                                                     │
│    ┌─────────────────────────────────────────────────────┐         │
│    │                    模块 I: 其他优化                   │         │
│    └─────────────────────────────────────────────────────┘         │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 模块详情

### 模块 A: 通用视图组件增强
**涉及需求**: REQ-001~011, REQ-022~027 (17个需求点)

| 子功能 | 需求编号 | 优先级 | 现有实现 |
|-------|---------|-------|---------|
| 网格视图列数切换(2-5列) | REQ-002~004 | P1 | 部分(1-4列) |
| 双指缩放切换列数手势 | REQ-003, REQ-008 | P1 | 无 |
| 列数切换过渡动效 | REQ-004, REQ-009 | P1 | 无 |
| 瀑布流视图列数切换(1-5列) | REQ-007~009 | P1 | 部分(1-4列) |
| 网格视图长按拖动多选 | REQ-005 | P0 | 已有 ✅ |
| 瀑布流视图禁用拖动多选 | REQ-010 | P0 | 已有 ✅ |
| 照片真实时间定义 | REQ-011 | P0 | 已有 ✅ |
| 排序按钮交互一致性 | REQ-022~023 | P0 | 部分 |
| 底部操作栏规范 | REQ-024~025 | P0 | 已有 ✅ |
| 复制照片功能 | REQ-026 | P0 | 已有 ✅ |
| 视图模式切换按钮 | REQ-027 | P0 | 已有 ✅ |

**主要涉及文件**:
- `ui/components/DragSelectPhotoGrid.kt`
- `ui/components/StaggeredPhotoGrid.kt`
- `ui/components/BottomActionBar.kt`
- `ui/state/PhotoSelectionStateHolder.kt`

**估计工作量**: 中等 - 主要是新增双指缩放手势和动效

---

### 模块 B: 全屏预览界面重构
**涉及需求**: REQ-012~021 (10个需求点)

| 子功能 | 需求编号 | 优先级 | 现有实现 |
|-------|---------|-------|---------|
| 基础布局(撑满屏幕) | REQ-012 | P0 | 部分 |
| 图片信息展示(5项) | REQ-013 | P0 | 无 |
| 照片预览条(滑动切换) | REQ-014 | P0 | 无 |
| 底部操作栏(5项) | REQ-015 | P0 | 部分 |
| 显示/隐藏切换 | REQ-016 | P0 | 无 |
| 双击缩放(1x↔2.5x) | REQ-017 | P0 | 已有 ✅ |
| 双指缩放(1-10倍) | REQ-018 | P0 | 部分(0.5-5x) |
| 左右滑动切换 | REQ-019 | P0 | 已有 ✅ |
| 下滑退出 | REQ-020 | P0 | 无 |
| 进入过渡动画 | REQ-021 | P1 | 无 |

**主要涉及文件**:
- `ui/components/FullscreenPhotoViewer.kt` (需大幅重构)
- 新增: `ui/components/PhotoPreviewStrip.kt`
- 新增: `ui/components/FullscreenPhotoInfo.kt`

**估计工作量**: 大 - 需要重构全屏预览组件

---

### 模块 C: 待定照片列表优化
**涉及需求**: REQ-028~032 (5个需求点)

| 子功能 | 需求编号 | 优先级 | 现有实现 |
|-------|---------|-------|---------|
| 排序选项(4种) | REQ-028 | P0 | 部分 |
| 点击选中(最多6张) | REQ-029 | P0 | 部分(无限制) |
| 拖动多选限制6张 | REQ-030 | P0 | 无(需新增) |
| 清除/对比按钮 | REQ-031 | P0 | 已有 ✅ |
| 对比模式全屏预览 | REQ-032 | P0 | 需集成模块B |

**主要涉及文件**:
- `ui/screens/photolist/PhotoListScreen.kt` (status=MAYBE)
- `ui/screens/photolist/PhotoListViewModel.kt`
- `ui/screens/lighttable/LightTableScreen.kt`

**估计工作量**: 小 - 主要是限制逻辑

---

### 模块 D: 回收站照片列表优化
**涉及需求**: REQ-033~036 (4个需求点)

| 子功能 | 需求编号 | 优先级 | 现有实现 |
|-------|---------|-------|---------|
| 排序选项(4种) | REQ-033 | P0 | 部分 |
| 点击进入全屏预览 | REQ-034 | P0 | 需集成模块B |
| 长按进入选择模式 | REQ-035 | P0 | 已有 ✅ |
| 底部操作(4项) | REQ-036 | P0 | 部分 |

**主要涉及文件**:
- `ui/screens/trash/TrashScreen.kt`
- `ui/screens/trash/TrashViewModel.kt`

**估计工作量**: 小

---

### 模块 E: 已保留照片列表优化
**涉及需求**: REQ-037~043 (7个需求点)

| 子功能 | 需求编号 | 优先级 | 现有实现 |
|-------|---------|-------|---------|
| 排序选项(5种含随机) | REQ-037 | P0 | 部分 |
| 已分类过滤开关 | REQ-038 | P0 | 无 |
| 点击进入全屏预览 | REQ-039 | P0 | 需集成模块B |
| 长按进入选择模式 | REQ-040 | P0 | 已有 ✅ |
| 底部操作(5项) | REQ-041 | P0 | 部分 |
| 添加到相册弹窗 | REQ-042 | P0 | 部分 |
| 快速分类模块 | REQ-043 | P0 | 已有 ✅ |

**主要涉及文件**:
- `ui/screens/photolist/PhotoListScreen.kt` (status=KEEP)
- `ui/screens/photolist/PhotoListViewModel.kt`

**估计工作量**: 中等

---

### 模块 F: 相册照片列表优化
**涉及需求**: REQ-044~050 (7个需求点)

| 子功能 | 需求编号 | 优先级 | 现有实现 |
|-------|---------|-------|---------|
| 排序选项(3种含随机) | REQ-044 | P0 | 已有 ✅ |
| 点击进入全屏预览 | REQ-045 | P0 | 需集成模块B |
| 长按进入选择模式 | REQ-046 | P0 | 已有 ✅ |
| 底部操作(4+1项) | REQ-047 | P0 | 部分 |
| 批量修改筛选状态 | REQ-048 | P0 | 无 |
| 添加到其他相册 | REQ-049 | P0 | 部分 |
| 顶部整理模块 | REQ-050 | P0 | 已有 ✅ |

**主要涉及文件**:
- `ui/screens/albums/AlbumPhotoListScreen.kt`
- `ui/screens/albums/AlbumPhotoListViewModel.kt`

**估计工作量**: 中等

---

### 模块 G: 时间线照片列表 (新增)
**涉及需求**: REQ-051~056 (6个需求点)

| 子功能 | 需求编号 | 优先级 | 现有实现 |
|-------|---------|-------|---------|
| 排序选项(3种含随机) | REQ-051 | P0 | 无 |
| 点击进入全屏预览 | REQ-052 | P0 | 无 |
| 长按进入选择模式 | REQ-053 | P0 | 无 |
| 底部操作(4+1项) | REQ-054 | P0 | 无 |
| 批量修改筛选状态 | REQ-055 | P0 | 无 |
| 顶部整理模块 | REQ-056 | P0 | 无 |

**主要涉及文件**:
- 新增: `ui/screens/timeline/TimelinePhotoListScreen.kt`
- 新增: `ui/screens/timeline/TimelinePhotoListViewModel.kt`
- 修改: `ui/screens/timeline/TimelineScreen.kt` (添加入口)

**估计工作量**: 中等 - 新页面但可复用大量组件

---

### 模块 H: 筛选列表优化
**涉及需求**: REQ-057~058 (2个需求点)

| 子功能 | 需求编号 | 优先级 | 现有实现 |
|-------|---------|-------|---------|
| 全局操作按钮 | REQ-057 | P0 | 部分 |
| 深度整理模式布局 | REQ-058 | P1 | 无 |

**主要涉及文件**:
- `ui/screens/flowsorter/FlowSorterScreen.kt`
- `ui/screens/flowsorter/FlowSorterViewModel.kt`

**估计工作量**: 小

---

### 模块 I: 其他优化需求
**涉及需求**: REQ-059~067 (9个需求点)

| 子功能 | 需求编号 | 优先级 | 现有实现 |
|-------|---------|-------|---------|
| 快速分类-编辑相册弹窗 | REQ-059 | P0 | 部分 |
| 快速分类-撤销功能 | REQ-060 | P0 | 无 |
| 相册列表-编辑入口 | REQ-061 | P1 | 无 |
| 相册列表-按钮样式统一 | REQ-062 | P1 | 无 |
| 照片状态指示器样式 | REQ-063 | P1 | 已有(需优化) |
| 筛选列表标题优化 | REQ-064 | P1 | 已有(需优化) |
| 每日任务跨天修复 | REQ-065 | P0 | Bug |
| 备选方案-列数按钮 | REQ-066 | P2 | 无 |
| 新手引导设计 | REQ-067 | P2 | 无 |

**主要涉及文件**:
- `ui/screens/flowsorter/FlowSorterScreen.kt`
- `ui/screens/albums/AlbumsScreen.kt`
- `ui/screens/home/HomeScreen.kt`
- `ui/components/PhotoStatusIndicator.kt` (新增或修改)

**估计工作量**: 中等 - 多个独立小任务

---

## 实施顺序建议

```
阶段 1 (基础层) - 必须先完成
├── 模块 A: 通用视图组件增强 ───┐
└── 模块 B: 全屏预览界面重构 ───┴── 为后续模块提供基础

阶段 2 (列表层) - 可并行
├── 模块 C: 待定照片列表
├── 模块 D: 回收站照片列表
├── 模块 E: 已保留照片列表
├── 模块 F: 相册照片列表
├── 模块 G: 时间线照片列表 (新增)
└── 模块 H: 筛选列表

阶段 3 (优化层)
└── 模块 I: 其他优化需求
```

---

## 需求覆盖检查

| 模块 | 需求范围 | 需求数量 | 已有实现 | 需新增/修改 |
|------|---------|---------|---------|-----------|
| A | REQ-001~011, 022~027 | 17 | 10 | 7 |
| B | REQ-012~021 | 10 | 3 | 7 |
| C | REQ-028~032 | 5 | 2 | 3 |
| D | REQ-033~036 | 4 | 2 | 2 |
| E | REQ-037~043 | 7 | 3 | 4 |
| F | REQ-044~050 | 7 | 4 | 3 |
| G | REQ-051~056 | 6 | 0 | 6 |
| H | REQ-057~058 | 2 | 1 | 1 |
| I | REQ-059~067 | 9 | 2 | 7 |
| **合计** | REQ-001~067 | **67** | 27 | **40** |

---

## 风险评估

| 风险项 | 影响模块 | 风险等级 | 缓解措施 |
|-------|---------|---------|---------|
| 双指缩放与滚动手势冲突 | A | 高 | 提供备选方案(REQ-066)按钮切换 |
| 全屏预览重构范围大 | B | 中 | 分子任务实施，保留回退路径 |
| 时间线照片列表新页面 | G | 中 | 复用现有组件和模式 |
| 撤销功能复杂度 | I | 中 | 先实现单步撤销，预留扩展 |

---

## 检查点 1: 请确认

1. **模块划分是否合理?** 是否需要合并或拆分某些模块?
2. **实施顺序是否正确?** 是否有遗漏的依赖关系?
3. **优先级是否正确?** 是否需要调整某些需求的优先级?
4. **关于双指缩放手势**: 是否先尝试实现，还是直接使用备选方案(按钮)?

请确认后，我将进入第2层规划，为每个模块制定详细实施方案。
